# KD-Tree
https://blog.csdn.net/v_JULY_v/article/details/8203674
## 1.背景
### 1.1 K近邻算法
即K-Nearest Neighbor(KNN)，可简单理解为K个最近邻居  
### 1.2 距离度量
- 欧氏距离
- 曼哈顿距离
- 切比雪夫距离
- 闵可夫斯基距离
- 标准化欧式距离
- 马氏距离（Manhalanobis Distance）
- 巴氏距离（Bhattacharyya Distance）
- 汉明距离（Hamming Distance）
- 夹角余弦（Cosine）
- 杰卡德相似系数
- 皮尔逊系数 
简单说来，各种“距离”的应用场景简单概括为，空间：欧氏距离，路径：曼哈顿距离，国际象棋国王：切比雪夫距离，以上三种的统一形式:闵可夫斯基距离，加权：标准化欧氏距离，排除量纲和依存：马氏距离，向量差距：夹角余弦，编码差别：汉明距离，集合近似度：杰卡德类似系数与距离，相关：相关系数与相关距离。

## 2. KD-Tree
*Multidimensional Binary Search Trees Used for Associative Searching* -ACM
### 2.1 定义
- k维
- 平衡二叉树
- 按某种规则将空间划分 
### 2.2 构建
a. 确定域split，可以根据方差确定最合适的split，也可以循环选取坐标轴  
b. 确定分割线，最好找中位线  
c. 确定左右子空间（递归）  
### 2.3 插入
类似二叉查找树的插入（不保证平衡性）
### 2.4 删除
- 类似二叉查找树删除，即从左右子树中找一个节点代替待删除的节点。实际情况会比这个复杂的多，因为kd-tree每一层划分的依据可能是不一样的  
- 可以标记删除，实际不删除节点。若标记删除节点达到某个阈值，rebuild整颗kd-tree  

### 2.5 最近邻搜索算法  
a. 搜寻路径，类似二叉查找树的搜索，将经过的节点压入栈中  
b. 回溯栈中路径节点，每次回溯都能获得**当前最小距离**，以目标节点为圆心，**当前最小距离**为半径，判断园是否与当前节点的另一个子空间有交集，若有，则以该子空间为根，重复步骤a  
c. 栈空时，算法结束  

### 2.6 BBF算法  
- kd-tree适合20维度以下的快速检索，维度过高（SIFT特征矢量128维，SURF特征矢量64维度），kd-tree的性能接近贪婪线性扫描。
- 设数据量为N，维度为D，一般来说要求N>>Math.Pow(2, D)  
- BBF(Best-Bin-First)  
    bin即为做分割的超平面  
    根据目标点到bin距离来确定优先级，以此选择**最合适**的下一个子空间
- BBF可以有效将维度扩展到高维空间  
### 2.7 球树、M树、VP树、MVP树
- 球树：类似k-means聚类，用球空间而非平面空间来分割整个数据空间  

